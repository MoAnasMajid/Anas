# -*- coding: utf-8 -*-
"""converting resulting SQLite databases.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/14bmdVHqT0n_RDSAyu7nAfHcxo5WlVUaC
"""

database_filename = '/content/traffic-intelligence' # Path of SQLite database file - to be specifed
output_filename = 'trackeval_data.txt'

# Load the trajectories
objects = storage.loadTrajectoriesFromSqlite(database_filename, 'object')

# Convert to Trackeval format
trackeval_data = []

for obj in objects:
    for feature in obj.features:
        for t, position in enumerate(feature.getPositions().aslist()):
            frame = feature.getFirstInstant() + t
            track_id = obj.getNum()
            bb_left = position[0]  # x coordinate
            bb_top = position[1]   # y coordinate
            bb_width = feature.getWidth() if hasattr(feature, 'getWidth') else 0
            bb_height = feature.getHeight() if hasattr(feature, 'getHeight') else 0
            conf = 1  # confidence score,
            x, y, z = -1, -1, -1  # world coordinates x,y,z are ignored for the 2D challenge and can be filled with -1

            trackeval_data.append([frame, track_id, bb_left, bb_top, bb_width, bb_height, conf, x, y, z])

# Save to file
with open(output_filename, 'w', newline='') as file:
    writer = csv.writer(file, delimiter=',')
    for row in trackeval_data:
        writer.writerow(row)